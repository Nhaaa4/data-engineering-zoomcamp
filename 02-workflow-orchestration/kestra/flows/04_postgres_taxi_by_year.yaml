id: 04_postgres_taxi_by_year
namespace: zoomcamp
description: "Select year & taxi, loop months 01-12 and trigger 04_postgres_taxi"

inputs:
  - id: year
    type: SELECT
    displayName: Select year
    values: ["2019", "2020"]
    defaults: "2019"

  - id: taxi
    type: SELECT
    displayName: Select taxi type
    values: ["yellow", "green"]
    defaults: "yellow"

tasks:
  - id: each_month
    type: io.kestra.plugin.core.flow.ForEach
    values: ["01","02","03","04","05","06","07","08","09","10","11","12"]
    concurrencyLimit: 2
    tasks:
      - id: run_month
        type: io.kestra.plugin.core.flow.Subflow
        namespace: zoomcamp
        flowId: 04_postgres_taxi
        wait: true
        allowFailure: true
        inputs:
          year: "{{ inputs.year }}"
          taxi: "{{ inputs.taxi }}"
          month: "{{ taskrun.value }}"
